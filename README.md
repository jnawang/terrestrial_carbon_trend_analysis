# Long-term trends and drivers of net carbon uptake of global terrestrial ecosystems

This project uses global eddy covariance CO2 flux data from AmeriFlux, FLUXNET, and ICOS to examine the long-term CO2 flux trends and their drivers of the terrestrial biosphere.

## Objectives

-   Calculate decadal trends of CO2 fluxes over the past two decades across a wide range of terrestrial ecosystems.
-   Identify the drivers of CO2 trends for different ecosystems.
-   Estimate the changes in CO2 flux trends at two-decade-long sites.
-   Predict CO2 flux trends of the past and future two decades at global vegetated lands.

## Structure of R and Python scripts

-   00_download_data
    -   00_download_flux_data
    -   00_01_era5_api_daily.py (API for downloading daily global climate data from ERA5)
    -   00_02_era5_api.py (API for downloading hourly climate data at certain locations from ERA5)
    -   00_03_ERA5_csv.rmd (convert data from ERA5 to csv files)
-   01_data_harmonization
    -   01_01_Ustar-filter_gap-fill_partition_AmeriFlux-BASE_sites.Rmd
    -   01_02_connect_European_FLUXNET_recent_ICOS.Rmd
    -   01_03_unify_four_flux_data.Rmd
-   02_quantify_NEE_trends_significant_trend_drivers
    -   02_01_growing_season_detection.Rmd
    -   02_02_trend_abrupt_change_sen.Rmd (calculate NEE trends by sen slope and the possibility of abrupt changes in NEE trends at long-term sites)
    -   02_03_trend_drivers_sen.Rmd (calculate potential driver variables)
    -   02_04_trend_drivers_causal_inference_brm.Rmd
-   03_scale_up
    -   03_00_download_future_climate.py
    -   03_01_upscale_global_NEE_trends.Rmd
  
## Operation system requirements
-   These scripts have been run and tested on the Mac mini system. It should work on normal window systems. 
-   We used R version 4.3.2 and python3 to run the R and python scripts. 
-   It does not need any non-standard hardware. 

## Installation guide
-   Instructions: clone the github repo, and it takes a few minutes.

## Demo
-   A simple demo was provided in the demos folder. 
-   The demos folder includes the script 02_04_trend_drivers_causal_inference_brm_demo.Rmd and two data files needed to run the script.
-   The 02_04 script is a key script for the entire work; it reads two small data files generated by other 01_ and 02_ scripts; it calculates effect sizes of potential NEE trend drivers.  
-   Most of other scripts need to read large raw data files that are currently saved on data server of the Malone lab. 
-   We plan to upload all the data and scripts to Zenodo before the manuscript is accepted. That way, all the scripts will be fully reproducible.

